<link rel="stylesheet" href="/cat/css/popup.css">

<div class="step-container">
    <div class="step-container-left">
        <img id="popupCardImage" src="" alt="Card Image">
        <div class="step-container-left-content">
            <button id="popupCardSelectButton" class="btn--secondary">Select</button>
        </div>
    </div>
    <div class="step-container-right">
        <div class="step-form title" id="popupCardTitle">
        </div>

        <div class="step-form descrip" id="popupCardDescription">
        </div>

        <hr>

        <div class="step-form info" id="popupCardInformation">
        </div>

        <div class="itinerary-departure-row">
            <div class="step-form itinerary-container" id="popupCardItinerary"></div>
            <div class="step-form departure-times">
                <div id="firstDepartureContainer"><strong>1st Departure:</strong> <span id="popupCardFirstDeparture"></span></div>
                <div id="secondDepartureContainer"><strong>2nd Departure:</strong> <span id="popupCardSecondDeparture"></span></div>
            </div>
        </div>

        <div class="itinerary-departure-row">
            <div class="step-form includes-container itinerary-container" id="popupCardIncludes">
            </div>
        </div>
        
        <div class="duration-container" id="popupCardDuration">
        </div>

        <div class="step-form recommendations" id="popupCardRecommendations">
        </div>

        <div class="button-container">
            <button type="button" class="step-button" onclick="window.location.href='modal.html?step=1'">Select</button>
        </div>
        
    </div>

</div>
<script>

    window.updatePopupContent = function() {

        const firstDepartureContainer = document.getElementById('firstDepartureContainer');
        const secondDepartureContainer = document.getElementById('secondDepartureContainer');

        if (firstDepartureContainer) firstDepartureContainer.style.display = 'none';
        if (secondDepartureContainer) secondDepartureContainer.style.display = 'none';

        const cardData = JSON.parse(localStorage.getItem('selectedCardData'));
        if (!cardData) return;


        const firstDepartureDiv = document.getElementById('popupCardFirstDeparture');
        const secondDepartureDiv = document.getElementById('popupCardSecondDeparture');
        if (firstDepartureDiv) firstDepartureDiv.textContent = '';
        if (secondDepartureDiv) secondDepartureDiv.textContent = '';

        // Imagen
        const img = document.getElementById('popupCardImage');
        if (img && cardData.image) img.src = cardData.image;

        // Título
        const titleDiv = document.getElementById('popupCardTitle');
        if (titleDiv && cardData.location) titleDiv.textContent = cardData.location;

        // Info
        const infoDiv = document.getElementById('popupCardInformation');
        if (infoDiv && cardData.information) infoDiv.textContent = cardData.information;

        // Descripción
        const descDiv = document.getElementById('popupCardDescription');
        if (descDiv && cardData.description) descDiv.textContent = cardData.description;

        const itineraryDiv = document.getElementById('popupCardItinerary');
        if (itineraryDiv && cardData.itinerary) {
            let itineraryArr = Array.isArray(cardData.itinerary) ? cardData.itinerary : String(cardData.itinerary).split(',');
            itineraryArr = itineraryArr.map(item => item.trim()).filter(item => item);
            itineraryDiv.innerHTML = `<h1>Itinerary</h1><ul>${itineraryArr.map(item => `<li>${item}</li>`).join('')}</ul>`;
        }


        if (firstDepartureDiv && cardData.firstDeparture && 
            (Array.isArray(cardData.firstDeparture) ? cardData.firstDeparture.length > 0 : String(cardData.firstDeparture).trim() !== '')) {
            if (Array.isArray(cardData.firstDeparture)) {
                firstDepartureDiv.innerHTML = cardData.firstDeparture.map(h => `${h}`).join('<br>');
            } else {
                firstDepartureDiv.textContent = cardData.firstDeparture;
            }
            if (firstDepartureContainer) {
                firstDepartureContainer.style.display = ''; 
                console.log('First Departure: SHOWING');
            }
        } else {
            if (firstDepartureContainer) {
                firstDepartureContainer.style.display = 'none'; 
                console.log('First Departure: HIDING');
            }
        }

        if (secondDepartureDiv && cardData.secondDeparture &&
            (Array.isArray(cardData.secondDeparture) ? cardData.secondDeparture.length > 0 : String(cardData.secondDeparture).trim() !== '')) {
            if (Array.isArray(cardData.secondDeparture)) {
                secondDepartureDiv.innerHTML = cardData.secondDeparture.map(h => `${h}`).join('<br>');
            } else {
                secondDepartureDiv.textContent = cardData.secondDeparture;
            }
            if (secondDepartureContainer) {
                secondDepartureContainer.style.display = ''; 
            }
        } else {
            if (secondDepartureContainer) {
                secondDepartureContainer.style.display = 'none'; 
            }
        }

        const includesDiv = document.getElementById('popupCardIncludes');
        if (includesDiv && cardData.includes) {
            let includesArr = Array.isArray(cardData.includes) ? cardData.includes : String(cardData.includes).split(',');
            includesArr = includesArr.map(item => item.trim()).filter(item => item);

            includesDiv.innerHTML = `<h1>Includes</h1><ul>${includesArr.map(item => `<li><img src="/components/img/icons/check_circle.svg" alt="Check" class="check-icon">${item}</li>`).join('')}</ul>`;
        }

        // Duración
        const durationDiv = document.getElementById('popupCardDuration');
        if (durationDiv && cardData.duration) {
            durationDiv.innerHTML = `<h5>Duration:</h5>${cardData.duration}`;
        }

        // Recomendaciones
        const recommendationsDiv = document.getElementById('popupCardRecommendations');
        if (recommendationsDiv && cardData.recommendations) {
            recommendationsDiv.innerHTML = `<h1>Recommendations</h1>${cardData.recommendations}`;
        }
    };

</script>